<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebAssembly Game Engine - Basic Demo</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: white;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            text-align: center;
            opacity: 0.8;
            margin-bottom: 30px;
        }
        
        .canvas-container {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        #gameCanvas {
            border: 3px solid rgba(255,255,255,0.2);
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            background: #1a1a1a;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .control-group {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .control-group h3 {
            margin-top: 0;
            color: #f0f0f0;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 25px;
            color: white;
            cursor: pointer;
            font-weight: bold;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(238, 90, 36, 0.4);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .info {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
        }
        
        .status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            padding: 10px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ WebAssembly Game Engine</h1>
        <p class="subtitle">High-performance 2D graphics with Rust + WebAssembly</p>
        
        <div class="canvas-container">
            <canvas id="gameCanvas" width="800" height="600"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>üéØ Sprites</h3>
                <button onclick="createRandomSprite()">Add Random Sprite</button>
                <button onclick="createColorfulSprites()">Create Rainbow</button>
                <button onclick="clearAllSprites()">Clear All</button>
            </div>
            
            <div class="control-group">
                <h3>üé® Colors</h3>
                <button onclick="randomizeColors()">Randomize Colors</button>
                <button onclick="setTheme('red')">Red Theme</button>
                <button onclick="setTheme('blue')">Blue Theme</button>
                <button onclick="setTheme('green')">Green Theme</button>
            </div>
            
            <div class="control-group">
                <h3>‚ö° Animation</h3>
                <button onclick="startAnimation()">Start Animation</button>
                <button onclick="stopAnimation()">Stop Animation</button>
                <button onclick="toggleBouncing()">Toggle Bouncing</button>
            </div>
        </div>
        
        <div class="info">
            <h3>üéÆ Controls</h3>
            <p><strong>Mouse:</strong> Click anywhere on the canvas to create a sprite</p>
            <p><strong>WASD:</strong> Move sprites around (when animation is off)</p>
            <p><strong>Space:</strong> Add a sprite at mouse position</p>
            <p><strong>Features:</strong> Real-time rendering, physics simulation, collision detection, audio support</p>
        </div>
    </div>
    
    <div class="status" id="status">Loading...</div>
    
    <div class="loading" id="loading">
        <p>üîÑ Loading WebAssembly Game Engine...</p>
        <p><small>This may take a moment on first load</small></p>
    </div>

    <script type="module">
        import { GameEngine } from '../js/game-engine.js';
        
        let engine;
        let sprites = [];
        let isAnimating = false;
        let isBouncing = false;
        let animationId = null;
        
        // Initialize engine
        async function init() {
            try {
                engine = new GameEngine('gameCanvas');
                const success = await engine.init();
                
                if (success) {
                    engine.start();
                    document.getElementById('loading').style.display = 'none';
                    
                    // Show which engine is running
                    const engineType = engine.useWasm ? 'WebAssembly' : 'JavaScript';
                    const icon = engine.useWasm ? 'ü¶Ä' : '‚ö°';
                    document.getElementById('status').textContent = `${icon} ${engineType} Engine Ready`;
                    
                    // Create initial sprites
                    createInitialSprites();
                    setupGameLoop();
                } else {
                    throw new Error('Failed to initialize engine');
                }
            } catch (error) {
                console.error('Initialization error:', error);
                document.getElementById('loading').innerHTML = `
                    <p>‚ùå Failed to load engine</p>
                    <p><small>${error.message}</small></p>
                    <p><small>Please ensure your browser supports WebAssembly</small></p>
                `;
                document.getElementById('status').textContent = '‚ùå Load Failed';
            }
        }
        
        function createInitialSprites() {
            // Create some initial sprites for demonstration
            for (let i = 0; i < 5; i++) {
                createRandomSprite();
            }
        }
        
        function setupGameLoop() {
            function gameLoop() {
                if (isAnimating) {
                    updateSprites();
                }
                animationId = requestAnimationFrame(gameLoop);
            }
            gameLoop();
        }
        
        function updateSprites() {
            const canvas = engine.getCanvasSize();
            const time = performance.now() * 0.001;
            
            sprites.forEach((sprite, index) => {
                if (isBouncing) {
                    // Bouncing animation
                    const speed = 100 + index * 20;
                    const x = Math.sin(time + index) * (canvas.width * 0.3) + canvas.width * 0.5;
                    const y = Math.cos(time * 1.5 + index) * (canvas.height * 0.3) + canvas.height * 0.5;
                    engine.moveSprite(sprite.id, x, y);
                } else {
                    // Circular motion
                    const radius = 150 + index * 30;
                    const angle = time + (index * Math.PI / 3);
                    const x = Math.cos(angle) * radius + canvas.width * 0.5;
                    const y = Math.sin(angle) * radius + canvas.height * 0.5;
                    engine.moveSprite(sprite.id, x, y);
                }
                
                // Color animation
                const hue = (time + index) % (Math.PI * 2);
                const color = hslToRgb(hue, 0.7, 0.6);
                engine.setSpriteColor(sprite.id, color);
            });
        }
        
        // Utility functions for the global scope
        window.createRandomSprite = function() {
            const canvas = engine.getCanvasSize();
            const sprite = engine.createSprite({
                x: Math.random() * (canvas.width - 50),
                y: Math.random() * (canvas.height - 50),
                width: 30 + Math.random() * 40,
                height: 30 + Math.random() * 40,
                color: GameEngine.Color.random()
            });
            sprites.push(sprite);
            document.getElementById('status').textContent = `Sprites: ${sprites.length}`;
        };
        
        window.createColorfulSprites = function() {
            const colors = [
                GameEngine.Color.RED,
                GameEngine.Color.GREEN,
                GameEngine.Color.BLUE,
                GameEngine.Color.YELLOW,
                GameEngine.Color.MAGENTA,
                GameEngine.Color.CYAN
            ];
            
            const canvas = engine.getCanvasSize();
            colors.forEach((color, i) => {
                const sprite = engine.createSprite({
                    x: (i + 1) * (canvas.width / (colors.length + 1)) - 25,
                    y: canvas.height * 0.5 - 25,
                    width: 50,
                    height: 50,
                    color: color
                });
                sprites.push(sprite);
            });
            document.getElementById('status').textContent = `Sprites: ${sprites.length}`;
        };
        
        window.clearAllSprites = function() {
            sprites = [];
            location.reload(); // Simple way to clear - in real implementation we'd have a proper clear method
        };
        
        window.randomizeColors = function() {
            sprites.forEach(sprite => {
                engine.setSpriteColor(sprite.id, GameEngine.Color.random());
            });
        };
        
        window.setTheme = function(theme) {
            const themeColors = {
                red: [GameEngine.Color.RED, {r: 0.8, g: 0.2, b: 0.2, a: 1.0}, {r: 1.0, g: 0.4, b: 0.4, a: 1.0}],
                blue: [GameEngine.Color.BLUE, {r: 0.2, g: 0.4, b: 0.8, a: 1.0}, {r: 0.4, g: 0.6, b: 1.0, a: 1.0}],
                green: [GameEngine.Color.GREEN, {r: 0.2, g: 0.8, b: 0.2, a: 1.0}, {r: 0.4, g: 1.0, b: 0.4, a: 1.0}]
            };
            
            const colors = themeColors[theme] || [GameEngine.Color.WHITE];
            sprites.forEach((sprite, i) => {
                const color = colors[i % colors.length];
                engine.setSpriteColor(sprite.id, color);
            });
        };
        
        window.startAnimation = function() {
            isAnimating = true;
            document.getElementById('status').textContent = 'üé¨ Animating...';
        };
        
        window.stopAnimation = function() {
            isAnimating = false;
            document.getElementById('status').textContent = '‚è∏Ô∏è Animation Stopped';
        };
        
        window.toggleBouncing = function() {
            isBouncing = !isBouncing;
            document.getElementById('status').textContent = isBouncing ? 'üèÄ Bouncing Mode' : 'üåÄ Circular Mode';
        };
        
        // Utility function to convert HSL to RGB
        function hslToRgb(h, s, l) {
            const c = (1 - Math.abs(2 * l - 1)) * s;
            const x = c * (1 - Math.abs((h / (Math.PI / 3)) % 2 - 1));
            const m = l - c / 2;
            
            let r, g, b;
            if (h < Math.PI / 3) {
                [r, g, b] = [c, x, 0];
            } else if (h < 2 * Math.PI / 3) {
                [r, g, b] = [x, c, 0];
            } else if (h < Math.PI) {
                [r, g, b] = [0, c, x];
            } else if (h < 4 * Math.PI / 3) {
                [r, g, b] = [0, x, c];
            } else if (h < 5 * Math.PI / 3) {
                [r, g, b] = [x, 0, c];
            } else {
                [r, g, b] = [c, 0, x];
            }
            
            return {
                r: r + m,
                g: g + m,
                b: b + m,
                a: 1.0
            };
        }
        
        // Start the engine when page loads
        init();
    </script>
</body>
</html>
